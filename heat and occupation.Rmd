---
title: "Heat and Occupation in heatlabor project directory"
author: "Diego Flores"
date: "8/16/2024"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(readxl)
library(janitor)
library(tidyverse)
library(tidyr)
library(dplyr)
library(ggplot2)
library(stargazer)
library(caret)
library(car)
#install.packages("kableExtra")
library(kableExtra)
#install.packages("sf")
library(sf)
library(usmap)
library(RColorBrewer)
library(maps)
library(mapdata)
library(leaflet)
library(lubridate)
library(choroplethr)
#install.packages("countyweather")  #not available for this R version
#install.packages("rnoaa")
library(sp)
library(spatial)
library(devtools)
```

Consider using a leaflet map, connects to google API, zooming sp - more traditional gis work
```{r api_install}
# install_github("mikeasilva/blsAPI") #success 
```

```{r industry_function}
# qcewGetIndustryData <- function (year, qtr, industry)
  
qcewGetIndustryData <- function (year, qtr, industry) {
	url <- "http://data.bls.gov/cew/data/api/YEAR/QTR/industry/INDUSTRY.csv"
	url <- sub("YEAR", year, url, ignore.case=FALSE)
	url <- sub("QTR", tolower(qtr), url, ignore.case=FALSE)
	url <- sub("INDUSTRY", industry, url, ignore.case=FALSE)
	read.csv(url, header = TRUE, sep = ",", quote="\"", dec=".", na.strings=" ", skip=0)
}
```

``` {r load_indsutry_data}
ffood <- qcewGetIndustryData("2023", "a", "722513")
str(ffood)
lac_ff <- ffood %>% 
  rename(fips = area_fips) %>% 
  filter(fips == "06037")
  
carwash <- qcewGetIndustryData("2023", "a", "811192")
lac_carwash <- carwash %>% 
  rename(fips = area_fips) %>% 
  filter(fips == "811192")
```

Area notes:
06037	Los Angeles County, California 
06059	Orange County, California
06071	San Bernardino County, California
Operating warehousing and storage facilities and providing related 
logistics services--are classified in Industry Group 4931, Warehousing and Storage.

```{r qcewarea_function}
qcewGetAreaData <- function(year, qtr, area) {
	url <- "http://data.bls.gov/cew/data/api/YEAR/QTR/area/AREA.csv"
	url <- sub("YEAR", year, url, ignore.case=FALSE)
	url <- sub("QTR", tolower(qtr), url, ignore.case=FALSE)
	url <- sub("AREA", toupper(area), url, ignore.case=FALSE)
	read.csv(url, header = TRUE, sep = ",", quote="\"", dec=".", na.strings=" ", skip=0)
}
```
CODEBOOK notes
own_code - 3 = public ownership 
annual_avg_estabs	= Annual average of quarterly establishment counts for a given year
total_annual_wages =	Sum of the four quarterly total wage levels for a given year
annual_contributions	=	Sum of the four quarterly contribution totals for a given year
annual_avg_wkly_wage	= Avg weekly wage based on 12-monthly employment levels and annual wage levels.
avg_annual_pay	=	Average annual pay
location quotient 
over the year change 
```{r area2}
lac_naics <- qcewGetAreaData("2023", "a", "06037") %>% #all industries in LAC 
  clean_names()

lac_naics2 <-  lac_naics %>% # Industries of interest below in LA county
  rename(fips = area_fips, 
         naics = industry_code) %>% 
  filter(naics %in% c("811192", "315", 
                      "493110", "722513")) #filter to see if NAICS obsvr are in the vector
```

```{r sample_area_df_screenshot}
#sample NAICS 
lac_naics2 <- lac_naics2[-c(2, 4:5, 7:8, 13, 16:26, 31:38)] 
```


